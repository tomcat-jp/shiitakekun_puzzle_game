<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>しいたけくんパズル</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
    }
    #header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #preview {
      width: 50px;
      height: 50px;
      border: 1px solid #ccc;
      margin-right: 10px;
      background-size: cover;
      background-position: center;
    }
    #controls {
      display: flex;
      align-items: center;
    }
    #timer {
      font-size: 14px;
      margin: 0 10px;
    }
    #board {
      margin-top: 10px;
      position: relative;
      width: 90vmin;
      height: 90vmin;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      border: 2px solid #000;
    }
    .tile {
      border: 1px solid #666; /* ← グリッド線 */
      background-size: 300% 300%;
      background-repeat: no-repeat;
      cursor: pointer;
      transition: none; /* 即時切替 */
    }
    #credit {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0,0,0,0.6);
      color: #fff;
      text-align: center;
      font-size: 12px;
      padding: 5px;
    }
    #credit img {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 5px;
    }
    #shareButton {
      display: none;
      margin-top: 10px;
      padding: 5px 10px;
      background: #1DA1F2;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="header">
    <div id="controls">
      <div id="preview"></div>
      <button onclick="shuffleTiles()">再シャッフル</button>
      <div id="timer">タイム: 0秒</div>
    </div>
  </div>

  <div id="board"></div>
  <button id="shareButton" onclick="shareToX()">Xでスコアを共有</button>

  <div id="credit">
    キャラクターデザイン　
    <img src="https://yt3.googleusercontent.com/giojR-aDzzL-bDMOFdF0RIqXhIQtSByPMIjE-fhsH_i-JALcd91j1TbmbGRVYnahF1e6ZIjurw=s160-c-k-c0x00ffffff-no-rj" alt="香椎きなこ">
    <a href="https://www.youtube.com/@Kinako_Kashii" target="_blank" style="color:#fff;">香椎きなこ Youtube</a>
  </div>

  <script>
    const board = document.getElementById("board");
    const timerEl = document.getElementById("timer");
    const preview = document.getElementById("preview");
    const shareButton = document.getElementById("shareButton");

    const size = 3;
    let tiles = [];
    let empty = {row: size - 1, col: size - 1};
    let startTime, timerInterval;
    let gameStarted = false;
    let elapsedTime = 0;

    const imgUrl = "7b2d91a1f350156e.png"; // ← あなたの画像ファイル名に差し替えてください

    preview.style.backgroundImage = `url(${imgUrl})`;

    function initBoard() {
      board.innerHTML = "";
      tiles = [];
      for (let row = 0; row < size; row++) {
        tiles[row] = [];
        for (let col = 0; col < size; col++) {
          if (row === size-1 && col === size-1) {
            tiles[row][col] = null;
            continue;
          }
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.style.backgroundImage = `url(${imgUrl})`;
          tile.style.backgroundPosition = `${(-col*100)/(size-1)}% ${(-row*100)/(size-1)}%`;
          tile.addEventListener("click", () => moveTile(row, col));
          board.appendChild(tile);
          tiles[row][col] = tile;
        }
      }
    }

    function shuffleTiles() {
      // 空白リセット
      empty = {row: size-1, col: size-1};
      let moves = 100;
      for (let i=0; i<moves; i++) {
        let neighbors = getNeighbors(empty.row, empty.col);
        let move = neighbors[Math.floor(Math.random() * neighbors.length)];
        swap(empty, move);
        empty = move;
      }
      gameStarted = true;
      startTime = Date.now();
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
      shareButton.style.display = "none";
    }

    function getNeighbors(row, col) {
      let neighbors = [];
      if (row > 0) neighbors.push({row: row-1, col});
      if (row < size-1) neighbors.push({row: row+1, col});
      if (col > 0) neighbors.push({row, col: col-1});
      if (col < size-1) neighbors.push({row, col: col+1});
      return neighbors;
    }

    function swap(a, b) {
      let temp = tiles[a.row][a.col];
      tiles[a.row][a.col] = tiles[b.row][b.col];
      tiles[b.row][b.col] = temp;
    }

    function moveTile(row, col) {
      if (!gameStarted) return;
      if (Math.abs(row - empty.row) + Math.abs(col - empty.col) === 1) {
        swap(empty, {row, col});
        empty = {row, col};
        render();
        if (isSolved()) {
          clearInterval(timerInterval);
          gameStarted = false;
          alert(`クリアしました！ タイム: ${elapsedTime}秒\nおめでとうございます`);
          shareButton.style.display = "block";
        }
      }
    }

    function render() {
      board.innerHTML = "";
      for (let row=0; row<size; row++) {
        for (let col=0; col<size; col++) {
          if (tiles[row][col]) {
            board.appendChild(tiles[row][col]);
          } else {
            const blank = document.createElement("div");
            board.appendChild(blank);
          }
        }
      }
    }

    function isSolved() {
      for (let row=0; row<size; row++) {
        for (let col=0; col<size; col++) {
          if (row === size-1 && col === size-1) continue; // ← 空白を判定に含めない
          const tile = tiles[row][col];
          if (!tile) return false;
          const bgPos = tile.style.backgroundPosition;
          const correctPos = `${(-col*100)/(size-1)}% ${(-row*100)/(size-1)}%`;
          if (bgPos !== correctPos) return false;
        }
      }
      return true;
    }

    function updateTimer() {
      elapsedTime = Math.floor((Date.now() - startTime) / 1000);
      timerEl.textContent = `タイム: ${elapsedTime}秒`;
    }

    function shareToX() {
      const text = `#しいたけくんパズル\nクリアタイム ${elapsedTime}秒です！\n#きなーこ見て\nパズルゲームのURL`;
      const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
      window.open(url, "_blank");
    }

    // 初期化
    initBoard();
    shuffleTiles();
  </script>
</body>
</html>
