<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>しいたけくんパズル</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #222;
      font-family: sans-serif;
      color: #fff;
    }
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 450px;
      aspect-ratio: 9/16;
      background: #333;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #puzzle-container {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 2px;
      width: 90%;
      max-width: 400px;
      aspect-ratio: 1/1;
      margin-top: 10px;
    }
    .tile {
      background-size: 300% 300%;
      cursor: pointer;
    }
    .hidden {
      background: none;
    }
    #preview {
      margin: 5px 0;
      width: 100px;
      height: 100px;
      background-size: cover;
      border: 2px solid #fff;
    }
    #controls {
      margin: 10px 0;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    #status {
      margin-top: 10px;
      text-align: center;
      font-size: 14px;
    }
    /* フッター（クレジット） */
    #footer {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 450px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      text-align: center;
      padding: 6px;
      font-size: 12px;
    }
    #footer img {
      vertical-align: middle;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 6px;
    }
    #footer a {
      color: #1DA1F2;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="preview"></div>
    <div id="controls">
      <button id="shuffleBtn">再シャッフル</button>
      <span id="timer">経過時間: 0.0 秒</span>
    </div>
    <div id="puzzle-container"></div>
    <div id="status"></div>
    <div id="footer">
      キャラクターデザイン　
      <img src="https://yt3.googleusercontent.com/giojR-aDzzL-bDMOFdF0RIqXhIQtSByPMIjE-fhsH_i-JALcd91j1TbmbGRVYnahF1e6ZIjurw=s160-c-k-c0x00ffffff-no-rj" alt="香椎きなこ">
      <a href="https://www.youtube.com/@Kinako_Kashii" target="_blank">香椎きなこ</a>
    </div>
  </div>

  <script>
    const PUZZLE_SIZE = 3;
    const puzzleContainer = document.getElementById("puzzle-container");
    const preview = document.getElementById("preview");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const timerDisplay = document.getElementById("timer");
    const statusMessage = document.getElementById("status");

    const imageUrl = "7b2d91a1f350156e.png"; // 差し替えてください
    preview.style.backgroundImage = `url(${imageUrl})`;

    let tiles = [];
    let empty = { x: PUZZLE_SIZE - 1, y: PUZZLE_SIZE - 1 };
    let isSolved = false;
    let timerInterval = null;
    let elapsedTime = 0;

    function initTiles() {
      tiles = [];
      puzzleContainer.innerHTML = "";
      for (let y = 0; y < PUZZLE_SIZE; y++) {
        for (let x = 0; x < PUZZLE_SIZE; x++) {
          if (x === PUZZLE_SIZE - 1 && y === PUZZLE_SIZE - 1) continue; // 空白
          const tile = document.createElement("div");
          tile.classList.add("tile");
          tile.style.backgroundImage = `url(${imageUrl})`;
          tile.style.backgroundPosition = `${(-x * 100) / (PUZZLE_SIZE - 1)}% ${(-y * 100) / (PUZZLE_SIZE - 1)}%`;
          tile.dataset.x = x;
          tile.dataset.y = y;
          puzzleContainer.appendChild(tile);
          tiles.push({ element: tile, x, y, currentX: x, currentY: y });
          tile.addEventListener("click", () => moveTile(tile.currentX, tile.currentY));
        }
      }
      empty = { x: PUZZLE_SIZE - 1, y: PUZZLE_SIZE - 1 };
    }

    function drawTiles() {
      tiles.forEach(tile => {
        tile.element.style.gridColumnStart = tile.currentX + 1;
        tile.element.style.gridRowStart = tile.currentY + 1;
      });
    }

    function moveTile(x, y) {
      if (isSolved) return;
      const targetTile = tiles.find(tile => tile.currentX === x && tile.currentY === y);
      if (!targetTile) return;

      if (Math.abs(empty.x - x) + Math.abs(empty.y - y) === 1) {
        const tempEmpty = { ...empty };
        empty = { x, y };
        targetTile.currentX = tempEmpty.x;
        targetTile.currentY = tempEmpty.y;
        drawTiles();

        if (checkCompletion()) {
          stopTimer();
          isSolved = true;
          const finalTime = elapsedTime.toFixed(1);
          statusMessage.innerHTML = `🎉 クリアタイム ${finalTime} 秒です！<br>おめでとうございます 🎉`;

          // X共有ボタン
          const shareText = `#しいたけくんパズル\nスコア ${finalTime} 秒でクリアしました！！\n#きなーこ見て\nhttps://your-puzzle-game-url.example`;
          const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;

          const shareBtn = document.createElement("a");
          shareBtn.href = twitterUrl;
          shareBtn.target = "_blank";
          shareBtn.textContent = "Xで共有する";
          shareBtn.style.display = "inline-block";
          shareBtn.style.marginTop = "10px";
          shareBtn.style.padding = "8px 16px";
          shareBtn.style.background = "#1DA1F2";
          shareBtn.style.color = "#fff";
          shareBtn.style.borderRadius = "6px";
          shareBtn.style.textDecoration = "none";
          shareBtn.style.fontWeight = "bold";

          statusMessage.appendChild(document.createElement("br"));
          statusMessage.appendChild(shareBtn);
        }
      }
    }

    function checkCompletion() {
      for (let i = 0; i < tiles.length; i++) {
        if (tiles[i].currentX === empty.x && tiles[i].currentY === empty.y) continue;
        if (tiles[i].x !== tiles[i].currentX || tiles[i].y !== tiles[i].currentY) return false;
      }
      return true;
    }

    function shuffleTiles() {
      for (let i = 0; i < 1000; i++) {
        const neighbors = tiles.filter(t =>
          Math.abs(t.currentX - empty.x) + Math.abs(t.currentY - empty.y) === 1
        );
        const randomTile = neighbors[Math.floor(Math.random() * neighbors.length)];
        const tempEmpty = { ...empty };
        empty = { x: randomTile.currentX, y: randomTile.currentY };
        randomTile.currentX = tempEmpty.x;
        randomTile.currentY = tempEmpty.y;
      }
      drawTiles();
      isSolved = false;
      elapsedTime = 0;
      statusMessage.textContent = "";
      startTimer();
    }

    function startTimer() {
      stopTimer();
      timerInterval = setInterval(() => {
        elapsedTime += 0.1;
        timerDisplay.textContent = `経過時間: ${elapsedTime.toFixed(1)} 秒`;
      }, 100);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    shuffleBtn.addEventListener("click", shuffleTiles);

    initTiles();
    drawTiles();
    shuffleTiles();
  </script>
</body>
</html>
